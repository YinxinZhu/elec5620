{% extends 'base.html' %}
{% block title %}Personnel Management · Learner Practice Portal{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-5">
    <h1 class="h3 mb-3">Personnel Management</h1>
    <p class="text-muted">Create new accounts or reset passwords for any coach, administrator, or student.</p>
    <div class="card">
      <div class="card-header">Add Account</div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="form_type" value="create">
          <div class="mb-3">
            <label class="form-label" for="role">Account Role</label>
            <select class="form-select" id="role" name="role" required>
              <option value="">Choose…</option>
              <option value="coach">Coach</option>
              <option value="student">Student</option>
              <option value="admin">Administrator</option>
            </select>
            <div class="form-text">Fill in the fields that match the selected role.</div>
          </div>
          <div class="mb-3">
            <label class="form-label" for="name">Name</label>
            <input class="form-control" id="name" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label" for="email">Email</label>
            <input type="email" class="form-control" id="email" name="email" required>
          </div>
          <div class="mb-3">
            <label class="form-label" for="password">Password</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>
          <div class="mb-3">
            <label class="form-label" for="state">State / Territory</label>
            <select class="form-select" id="state" name="state" required>
              <option value="">Choose…</option>
              {% for state in state_choices %}
              <option value="{{ state }}">{{ state }}</option>
              {% endfor %}
            </select>
          </div>
          <hr>
          <h6>Coach &amp; Administrator details</h6>
          <div class="mb-3">
            <label class="form-label" for="coach_mobile_number">Mobile number</label>
            <input type="tel" class="form-control" id="coach_mobile_number" name="mobile_number" placeholder="Required for coach/admin accounts">
          </div>
          <div class="mb-3">
            <label class="form-label" for="city">City</label>
            <input class="form-control" id="city" name="city" placeholder="Required for coach/admin accounts">
          </div>
          <div class="mb-3">
            <span class="form-label d-block">Vehicle Types</span>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="vehicle_at" name="vehicle_types" value="AT">
              <label class="form-check-label" for="vehicle_at">AT</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="vehicle_mt" name="vehicle_types" value="MT">
              <label class="form-check-label" for="vehicle_mt">MT</label>
            </div>
          </div>
          <hr>
          <h6>Student details</h6>
          <div class="mb-3">
            <label class="form-label" for="mobile_number">Mobile number</label>
            <input type="tel" class="form-control" id="mobile_number" name="mobile_number" placeholder="Required for student accounts">
          </div>
          <div class="mb-3">
            <label class="form-label" for="assigned_coach_id">Assigned coach</label>
            <select class="form-select" id="assigned_coach_id" name="assigned_coach_id">
              <option value="">Unassigned</option>
              {% for coach in coach_choices %}
              <option value="{{ coach.id }}">{{ coach.name }} ({{ coach.mobile_number }})</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Create account</button>
        </form>
      </div>
    </div>
  </div>
  <div class="col-lg-7">
    <div class="mb-4">
      <h2 class="h5">Coaches &amp; Administrators</h2>
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th scope="col">Role</th>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Mobile</th>
              <th scope="col">Location</th>
              <th scope="col">Update password</th>
            </tr>
          </thead>
          <tbody>
            {% for coach in coaches %}
            <tr>
              <td>{% if coach.is_admin %}<span class="badge bg-warning text-dark">Admin</span>{% else %}Coach{% endif %}</td>
              <td>{{ coach.name }}</td>
              <td>{{ coach.email }}</td>
              <td>{{ coach.mobile_number }}</td>
              <td>{{ coach.city }}, {{ coach.state }}</td>
              <td>
                <form class="d-flex gap-2" method="post">
                  <input type="hidden" name="form_type" value="update_password">
                  <input type="hidden" name="account_type" value="{% if coach.is_admin %}admin{% else %}coach{% endif %}">
                  <input type="hidden" name="account_id" value="{{ coach.id }}">
                  <input type="password" name="new_password" class="form-control form-control-sm" placeholder="New password" required>
                  <button type="submit" class="btn btn-outline-primary btn-sm">Save</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="6" class="text-muted">No coach accounts available.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div>
      <h2 class="h5">Students</h2>
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col">Email</th>
              <th scope="col">Mobile</th>
              <th scope="col">Coach</th>
              <th scope="col">Update password</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr>
              <td>{{ student.name }}</td>
              <td>{{ student.email }}</td>
              <td>{{ student.mobile_number }}</td>
              <td>{% if student.coach %}{{ student.coach.name }}{% else %}<span class="text-muted">Unassigned</span>{% endif %}</td>
              <td>
                <form class="d-flex gap-2" method="post">
                  <input type="hidden" name="form_type" value="update_password">
                  <input type="hidden" name="account_type" value="student">
                  <input type="hidden" name="account_id" value="{{ student.id }}">
                  <input type="password" name="new_password" class="form-control form-control-sm" placeholder="New password" required>
                  <button type="submit" class="btn btn-outline-primary btn-sm">Save</button>
                </form>
              </td>
            </tr>
            {% else %}
            <tr><td colspan="5" class="text-muted">No student accounts available.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
